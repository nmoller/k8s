apiVersion: v1
kind: Pod
metadata:
  name: inscription-pod1
  namespace: siad-moodle-dev-01
spec:
  volumes:
  - name: moodle01-storage
    persistentVolumeClaim:
     claimName: pvc-siad-moodle-dev-01-vol01
  - name: moodle01-nfsweb
    persistentVolumeClaim:
      claimName: pvc-siad-moodle-dev-01-nfsweb
  - name: moodle01-nfsinscription
    persistentVolumeClaim:
      claimName: pvc-siad-moodle-dev-01-nfsinscription
  containers:
  - image: nmolleruq/insc:1.1
    name: dumper
    resources:
      limits:
        cpu: 300m
        memory: 250Mi
      requests:
        cpu: 50m
        memory: 20Mi
    env:
    - name: MDL_DBTYPE
      valueFrom:
        configMapKeyRef:
          name: moodle01-config
          key: dbtype
    - name: MDL_DATAROOT
      valueFrom:
        configMapKeyRef:
          name: moodle01-config
          key: dataroot
    - name: MDL_MEMSESSION
      valueFrom:
        configMapKeyRef:
          name: moodle01-config
          key: memsession
    - name: MDL_LOCALCACHEDIR
      valueFrom:
        configMapKeyRef:
          name: moodle01-config
          key: localcachedir
    - name: MDL_WWWROOT
      valueFrom:
        configMapKeyRef:
          name: moodle01-config
          key: wwwroot
    - name: MDL_DBHOST
      valueFrom:
        secretKeyRef:
          name: secrets-moodle01-dev
          key: db_host
    - name: MDL_DBNAME
      valueFrom:
        secretKeyRef:
          name: secrets-moodle01-dev
          key: db_name
    - name: MDL_DBUSER
      valueFrom:
        secretKeyRef:
          name: secrets-moodle01-dev
          key: db_username
    - name: MDL_DBPASS
      valueFrom:
        secretKeyRef:
          name: secrets-moodle01-dev
          key: db_password
    - name: USAGER
      valueFrom:
        configMapKeyRef:
          name: moodle01-config
          key: ora_user
    - name: PASSWORD
      valueFrom:
        secretKeyRef:
          name: secrets-moodle01-dev
          key: ora_password
    - name: ORACLE_HOME
      valueFrom:
        configMapKeyRef:
          name: moodle01-config
          key: ora_home
    - name: PERL5LIB
      valueFrom:
        configMapKeyRef:
          name: moodle01-config
          key: perl5lib
    volumeMounts:
    - mountPath: /mnt/NFSlog
      name: moodle01-storage
    - mountPath: /mnt/NFSweb
      name: moodle01-nfsweb
    - mountPath: /mnt/NFSinscriptions
      name: moodle01-nfsinscription
    args:
    - /bin/sh
    - -c
    - "trap : TERM INT; sleep infinity & wait"
  restartPolicy: Never